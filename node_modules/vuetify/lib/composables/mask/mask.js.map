{"version":3,"file":"mask.js","names":["computed","isObject","propsFactory","makeMaskProps","mask","String","Object","defaultDelimiters","presets","date","phone","social","time","isMaskDelimiter","char","test","defaultTokens","pattern","A","convert","v","toUpperCase","a","toLowerCase","N","n","X","useMask","props","tokens","isMask","value","maskValidates","item","maskText","text","trimmedText","trim","replace","length","textIndex","maskIndex","newText","mchar","tchar","unmaskText","isValid","isComplete","maskedText","unmask"],"sources":["../../../src/composables/mask/mask.ts"],"sourcesContent":["// Utilities\nimport { computed } from 'vue'\nimport { isObject, propsFactory } from '@/util'\n\n// Types\nimport type { PropType } from 'vue'\n\nexport interface MaskProps {\n  mask: string | MaskOptions | undefined\n}\n\nexport interface MaskOptions {\n  mask: string\n  tokens: Record<string, MaskItem>\n}\n\nexport const makeMaskProps = propsFactory({\n  mask: [String, Object] as PropType<string | MaskOptions>,\n}, 'mask')\n\nexport type MaskItem = {\n  convert?: (char: string) => string\n} & ({\n  pattern?: never\n  test: (char: string) => boolean\n} | {\n  pattern: RegExp\n  test?: never\n})\n\nexport const defaultDelimiters = /[-!$%^&*()_+|~=`{}[\\]:\";'<>?,./\\\\ ]/\n\nconst presets: Record<string, string> = {\n  'credit-card': '#### - #### - #### - ####',\n  date: '##/##/####',\n  'date-time': '##/##/#### ##:##',\n  'iso-date': '####-##-##',\n  'iso-date-time': '####-##-## ##:##',\n  phone: '(###) ### - ####',\n  social: '###-##-####',\n  time: '##:##',\n  'time-with-seconds': '##:##:##',\n}\n\nexport function isMaskDelimiter (char: string): boolean {\n  return char ? defaultDelimiters.test(char) : false\n}\n\nconst defaultTokens: Record<string, MaskItem> = {\n  '#': {\n    pattern: /[0-9]/,\n  },\n  A: {\n    pattern: /[A-Z]/i,\n    convert: v => v.toUpperCase(),\n  },\n  a: {\n    pattern: /[a-z]/i,\n    convert: v => v.toLowerCase(),\n  },\n  N: {\n    pattern: /[0-9A-Z]/i,\n    convert: v => v.toUpperCase(),\n  },\n  n: {\n    pattern: /[0-9a-z]/i,\n    convert: v => v.toLowerCase(),\n  },\n  X: {\n    pattern: defaultDelimiters,\n  },\n}\n\nexport function useMask (props: MaskProps) {\n  const mask = computed(() => {\n    if (typeof props.mask === 'string') {\n      if (props.mask in presets) return presets[props.mask]\n      return props.mask\n    }\n    return props.mask?.mask ?? ''\n  })\n  const tokens = computed(() => {\n    return {\n      ...defaultTokens,\n      ...(isObject(props.mask) ? props.mask.tokens : null),\n    }\n  })\n\n  function isMask (char: string): boolean {\n    return char in tokens.value\n  }\n\n  function maskValidates (mask: string, char: string): boolean {\n    if (char == null || !isMask(mask)) return false\n    const item = tokens.value[mask]\n    if (item.pattern) return item.pattern.test(char)\n    return item.test(char)\n  }\n\n  function convert (mask: string, char: string): string {\n    const item = tokens.value[mask]\n    return item.convert ? item.convert(char) : char\n  }\n\n  function maskText (text: string | null | undefined): string {\n    const trimmedText = text?.trim().replace(/\\s+/g, ' ')\n\n    if (trimmedText == null) return ''\n\n    if (!mask.value.length || !trimmedText.length) return trimmedText\n\n    let textIndex = 0\n    let maskIndex = 0\n    let newText = ''\n\n    while (maskIndex < mask.value.length) {\n      const mchar = mask.value[maskIndex]\n      const tchar = trimmedText[textIndex]\n\n      // Escaped character in mask, the next mask character is inserted\n      if (mchar === '\\\\') {\n        newText += mask.value[maskIndex + 1]\n        maskIndex += 2\n        continue\n      }\n\n      if (!isMask(mchar)) {\n        newText += mchar\n        if (tchar === mchar) {\n          textIndex++\n        }\n      } else if (maskValidates(mchar, tchar)) {\n        newText += convert(mchar, tchar)\n        textIndex++\n      } else {\n        break\n      }\n\n      maskIndex++\n    }\n    return newText\n  }\n\n  function unmaskText (text: string | null): string | null {\n    if (text == null) return null\n\n    if (!mask.value.length || !text.length) return text\n\n    let textIndex = 0\n    let maskIndex = 0\n    let newText = ''\n\n    while (true) {\n      const mchar = mask.value[maskIndex]\n      const tchar = text[textIndex]\n\n      if (tchar == null) break\n\n      if (mchar == null) {\n        newText += tchar\n        textIndex++\n        continue\n      }\n\n      // Escaped character in mask, skip the next input character\n      if (mchar === '\\\\') {\n        if (tchar === mask.value[maskIndex + 1]) {\n          textIndex++\n        }\n        maskIndex += 2\n        continue\n      }\n\n      if (maskValidates(mchar, tchar)) {\n        // masked char\n        newText += tchar\n        textIndex++\n        maskIndex++\n        continue\n      } else if (mchar !== tchar) {\n        // input doesn't match mask, skip forward until it does\n        while (true) {\n          const mchar = mask.value[maskIndex++]\n          if (mchar == null || maskValidates(mchar, tchar)) break\n        }\n        continue\n      }\n\n      textIndex++\n      maskIndex++\n    }\n    return newText\n  }\n\n  function isValid (text: string): boolean {\n    if (!text) return false\n\n    return unmaskText(text) === unmaskText(maskText(text))\n  }\n\n  function isComplete (text: string): boolean {\n    if (!text) return false\n\n    const maskedText = maskText(text)\n    return maskedText.length === mask.value.length && isValid(text)\n  }\n\n  return {\n    isValid,\n    isComplete,\n    mask: maskText,\n    unmask: unmaskText,\n  }\n}\n"],"mappings":"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","ignoreList":[]}