{"version":3,"file":"calendarBase.js","names":["useTimes","computeColor","useDate","provideLocale","computed","createDayList","createNativeLocaleFormatter","getEndOfMonth","getEndOfWeek","getStartOfMonth","getStartOfWeek","getTimestampIdentifier","getWeekdaySkips","parseDate","parseTimestamp","validateTimestamp","validateWeekdays","propsFactory","makeCalendarBaseProps","start","type","String","Number","Date","validate","default","date","end","weekdays","Array","firstDayOfWeek","firstDayOfYear","weekdayFormat","Function","dayFormat","locale","now","validator","useCalendarBase","props","times","updateTimes","adapter","parsedStart","parsedEnd","value","parsedValue","modelValue","today","parsedWeekdays","isArray","split","map","x","parseInt","first","toJsDate","startOfWeek","getDay","toSorted","filter","v","effectiveWeekdays","days","categoryDays","weekday","from","length","_","i","weekdaySkips","dayFormatter","current","timeZone","day","weekdayFormatter","_tms","short","getColorProps","colors","getRelativeClasses","timestamp","outside","arguments","undefined","present","past","future","getWeekNumber","getWeek","_getStartOfWeek","_getEndOfWeek","getFormatter","options"],"sources":["../../../../src/components/VCalendar/composables/calendarBase.ts"],"sourcesContent":["// Composables\nimport { useTimes } from './times'\nimport { computeColor } from '@/composables/color'\nimport { useDate } from '@/composables/date'\nimport { provideLocale } from '@/composables/locale'\n\n// Utilities\nimport { computed } from 'vue'\nimport {\n  createDayList,\n  createNativeLocaleFormatter,\n  getEndOfMonth,\n  getEndOfWeek,\n  getStartOfMonth,\n  getStartOfWeek,\n  getTimestampIdentifier,\n  getWeekdaySkips,\n  parseDate,\n  parseTimestamp,\n  validateTimestamp,\n  validateWeekdays,\n} from '../util/timestamp'\nimport { propsFactory } from '@/util'\n\n// Types\nimport type { PropType } from 'vue'\nimport type { CalendarFormatter, CalendarTimestamp } from '../types'\nimport type { ColorValue } from '@/composables/color'\n\nexport const makeCalendarBaseProps = propsFactory({\n  start: {\n    type: [String, Number, Date],\n    validate: validateTimestamp,\n    default: () => parseDate(new Date()).date,\n  },\n  end: {\n    type: [String, Number, Date],\n    validate: validateTimestamp,\n  },\n  weekdays: {\n    type: [Array, String] as PropType<number[] | string>,\n    default: () => [0, 1, 2, 3, 4, 5, 6],\n    validate: validateWeekdays,\n  },\n  firstDayOfWeek: [Number, String],\n  firstDayOfYear: [Number, String],\n  weekdayFormat: {\n    type: Function as PropType<CalendarFormatter>,\n    default: null,\n  },\n  dayFormat: {\n    type: Function as PropType<CalendarFormatter>,\n    default: null,\n  },\n  locale: String,\n  now: {\n    type: String,\n    validator: validateTimestamp,\n  },\n  type: {\n    type: String as PropType<'month' | 'week' | 'day' | '4day' | 'custom-weekly' | 'custom-daily' | 'category'>,\n    default: 'month',\n  },\n}, 'VCalendar-base')\n\nexport interface CalendarBaseProps {\n  modelValue?: string | number | Date\n  categoryDays?: string | number\n  start: string | number | Date\n  end: string | number | Date | undefined\n  weekdays: string | number[]\n  firstDayOfWeek: number | string | undefined\n  firstDayOfYear: number | string | undefined\n  weekdayFormat: CalendarFormatter | string | undefined\n  dayFormat: CalendarFormatter | string | undefined\n  locale: string | undefined\n  now: string | undefined\n  type: 'month' | 'week' | 'day' | '4day' | 'custom-weekly' | 'custom-daily' | 'category'\n}\n\nexport function useCalendarBase (props: CalendarBaseProps) {\n  const { times, updateTimes } = useTimes({ now: props.now })\n  const locale = provideLocale(props)\n\n  const adapter = useDate()\n\n  const parsedStart = computed((): CalendarTimestamp => {\n    if (props.type === 'month') {\n      return getStartOfMonth(parseTimestamp(props.start, true))\n    }\n    return parseTimestamp(props.start, true)\n  })\n\n  const parsedEnd = computed((): CalendarTimestamp => {\n    const start = parsedStart.value\n    const end: CalendarTimestamp = props.end ? parseTimestamp(props.end) || start : start\n    const value = getTimestampIdentifier(end) < getTimestampIdentifier(start) ? start : end\n\n    if (props.type === 'month') {\n      return getEndOfMonth(value)\n    }\n    return value\n  })\n\n  const parsedValue = computed((): CalendarTimestamp => {\n    return (validateTimestamp(props.modelValue)\n      ? parseTimestamp(props.modelValue, true)\n      : (parsedStart.value || times.today))\n  })\n\n  const parsedWeekdays = computed((): number[] => {\n    const weekdays = Array.isArray(props.weekdays)\n      ? props.weekdays\n      : (props.weekdays || '').split(',').map(x => parseInt(x, 10))\n\n    const first = adapter.toJsDate(adapter.startOfWeek(adapter.date(), props.firstDayOfWeek)).getDay()\n    return [\n      ...weekdays.toSorted().filter(v => v >= first),\n      ...weekdays.toSorted().filter(v => v < first),\n    ]\n  })\n\n  const effectiveWeekdays = computed((): number[] => {\n    const start = parsedValue.value\n    const days = parseInt(String(props.categoryDays)) || 1\n\n    switch (props.type) {\n      case 'day': return [start.weekday]\n      case '4day': return [\n        start.weekday,\n        (start.weekday + 1) % 7,\n        (start.weekday + 2) % 7,\n        (start.weekday + 3) % 7,\n      ]\n      case 'category': return Array.from({ length: days }, (_, i) => (start.weekday + i) % 7)\n      default: return parsedWeekdays.value\n    }\n  })\n\n  const weekdaySkips = computed((): number[] => {\n    return getWeekdaySkips(parsedWeekdays.value)\n  })\n\n  const days = computed((): CalendarTimestamp[] => {\n    return createDayList(\n      parsedStart.value,\n      parsedEnd.value,\n      times.today,\n      weekdaySkips.value,\n    )\n  })\n\n  const dayFormatter = computed((): CalendarFormatter => {\n    if (props.dayFormat) {\n      return props.dayFormat as CalendarFormatter\n    }\n\n    return createNativeLocaleFormatter(\n      locale.current.value,\n      () => ({ timeZone: 'UTC', day: 'numeric' })\n    )\n  })\n\n  const weekdayFormatter = computed((): CalendarFormatter => {\n    if (props.weekdayFormat) {\n      return props.weekdayFormat as CalendarFormatter\n    }\n\n    return createNativeLocaleFormatter(\n      locale.current.value,\n      (_tms, short) => ({ timeZone: 'UTC', weekday: short ? 'short' : 'long' })\n    )\n  })\n\n  function getColorProps (colors: { background?: ColorValue, text?: ColorValue }) {\n    return computeColor(colors)\n  }\n\n  function getRelativeClasses (timestamp: CalendarTimestamp, outside = false) {\n    return {\n      'v-present': timestamp.present,\n      'v-past': timestamp.past,\n      'v-future': timestamp.future,\n      'v-outside': outside,\n    }\n  }\n\n  function getWeekNumber (timestamp: CalendarTimestamp): number {\n    return adapter.getWeek(\n      adapter.date(timestamp.date),\n      props.firstDayOfWeek,\n      props.firstDayOfYear,\n    )\n  }\n\n  function _getStartOfWeek (timestamp: CalendarTimestamp): CalendarTimestamp {\n    return getStartOfWeek(timestamp, parsedWeekdays.value, times.today)\n  }\n\n  function _getEndOfWeek (timestamp: CalendarTimestamp): CalendarTimestamp {\n    return getEndOfWeek(timestamp, parsedWeekdays.value, times.today)\n  }\n\n  function getFormatter (options: Intl.DateTimeFormatOptions): CalendarFormatter {\n    return createNativeLocaleFormatter(locale.current.value, () => options)\n  }\n\n  return {\n    times,\n    locale,\n    parsedValue,\n    parsedWeekdays,\n    effectiveWeekdays,\n    weekdaySkips,\n    parsedStart,\n    parsedEnd,\n    days,\n    dayFormatter,\n    weekdayFormatter,\n    getColorProps,\n    getRelativeClasses,\n    getWeekNumber,\n    getStartOfWeek: _getStartOfWeek,\n    getEndOfWeek: _getEndOfWeek,\n    getFormatter,\n    updateTimes,\n  }\n}\n"],"mappings":"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","ignoreList":[]}