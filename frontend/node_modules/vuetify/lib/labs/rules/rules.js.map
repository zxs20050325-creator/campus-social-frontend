{"version":3,"file":"rules.js","names":["computed","inject","toRef","createRules","options","locale","t","aliases","required","err","v","email","test","number","isNaN","Number","integer","capital","maxLength","len","length","minLength","strictLength","exclude","forbiddenCharacters","error","character","includes","notEmpty","pattern","resolve","fn","map","rule","ruleName","ruleParams","undefined","Array","isArray","slice","startsWith","RulesSymbol","Symbol","for","useRules","rules","Error"],"sources":["../../../src/labs/rules/rules.ts"],"sourcesContent":["// Utilities\nimport { computed, inject, toRef } from 'vue'\n\n// Types\nimport type { InjectionKey, Ref } from 'vue'\nimport type { LocaleInstance } from '@/composables/locale'\nimport type { ValidationProps, ValidationRule } from '@/composables/validation'\n\nexport type ValidationRuleBuilderWithoutOptions = (err?: string) => ValidationRule\nexport type ValidationRuleBuilderWithOptions<T> = (options: T, err?: string) => ValidationRule\nexport type ValidationRuleBuilder =\n  | ValidationRuleBuilderWithoutOptions\n  | ValidationRuleBuilderWithOptions<any>\n\nexport interface RuleAliases {\n  [name: string]: ValidationRuleBuilder\n  required: ValidationRuleBuilderWithoutOptions\n  email: ValidationRuleBuilderWithoutOptions\n  number: ValidationRuleBuilderWithoutOptions\n  integer: ValidationRuleBuilderWithoutOptions\n  capital: ValidationRuleBuilderWithoutOptions\n  maxLength: ValidationRuleBuilderWithOptions<number>\n  minLength: ValidationRuleBuilderWithOptions<number>\n  strictLength: ValidationRuleBuilderWithOptions<number>\n  exclude: ValidationRuleBuilderWithOptions<string[]>\n  notEmpty: ValidationRuleBuilderWithoutOptions\n  pattern: ValidationRuleBuilderWithOptions<RegExp>\n}\n\nexport type RulesOptions = {\n  aliases?: Partial<RuleAliases>\n}\n\ntype ValidationRuleParams = [any, string?]\nexport type ValidationAlias = string | [string, ...ValidationRuleParams]\n\nexport type RulesInstance = {\n  resolve: (fn: () => ValidationProps['rules']) => Readonly<Ref<any[]>>\n  aliases: RuleAliases\n}\n\nexport function createRules (options: RulesOptions | undefined, locale: LocaleInstance) {\n  const { t } = locale\n\n  const aliases: RuleAliases = {\n    required: (err?: string) => {\n      return (v: any) => {\n        // If the modifier .number is used, the 0 will be a number and it's a falsy value so we need to check for it\n        return v === 0 || !!v || t(err || '$vuetify.rules.required')\n      }\n    },\n    email: (err?: string) => {\n      return (v: any) => (!v || (typeof v === 'string' && /^.+@\\S+\\.\\S+$/.test(v))) || t(err || '$vuetify.rules.email')\n    },\n    number: (err?: string) => {\n      return (v: string) => !v || !isNaN(Number(v)) || t(err || '$vuetify.rules.number')\n    },\n    integer: (err?: string) => {\n      return (v: string) => (/^[\\d]*$/.test(v)) || t(err || '$vuetify.rules.integer')\n    },\n    capital: (err?: string) => {\n      return (v: string) => (/^[A-Z]*$/.test(v)) || t(err || '$vuetify.rules.capital')\n    },\n    maxLength: (len: number, err?: string) => {\n      return (v: any) => (!v || v.length <= len) || t(err || '$vuetify.rules.maxLength', len)\n    },\n    minLength: (len: number, err?: string) => {\n      return (v: any) => (!v || v.length >= len) || t(err || '$vuetify.rules.minLength', len)\n    },\n    strictLength: (len: number, err?: string) => {\n      return (v: any) => (!v || v.length === len) || t(err || '$vuetify.rules.strictLength', len)\n    },\n    exclude: (forbiddenCharacters: string[], err?: string) => {\n      return (v: string) => {\n        let error: string | true = true\n        for (const character of forbiddenCharacters) {\n          if (v.includes(character)) error = err || t('$vuetify.rules.exclude', character)\n        }\n        return error\n      }\n    },\n    notEmpty: (err?: string) => {\n      return (v: any) => (v && v.length > 0) || t(err || '$vuetify.rules.notEmpty')\n    },\n    pattern: (pattern: RegExp, err?: string) => {\n      return (v: any) => (!v || pattern.test(v) || t(err || '$vuetify.rules.pattern'))\n    },\n\n    ...options?.aliases,\n  }\n\n  function resolve (fn: () => ValidationProps['rules']) {\n    return computed(() => fn().map(rule => {\n      let ruleName: string | null = null\n      let ruleParams: ValidationRuleParams = [undefined]\n      if (Array.isArray(rule)) {\n        ruleName = rule[0]\n        ruleParams = rule.slice(1) as ValidationRuleParams\n      } else if (typeof rule === 'string') {\n        ruleName = rule\n      }\n\n      if (ruleName !== null) {\n        if (ruleName.startsWith('$')) {\n          ruleName = ruleName.slice(1)\n        }\n\n        return aliases[ruleName]?.(...ruleParams)\n      } else {\n        return rule\n      }\n    }))\n  }\n\n  return {\n    resolve,\n    aliases,\n  }\n}\n\nexport const RulesSymbol: InjectionKey<RulesInstance> = Symbol.for('vuetify:rules')\n\nexport function useRules (): RuleAliases\nexport function useRules (fn: () => ValidationProps['rules']): Readonly<Ref<ValidationProps['rules']>> | Readonly<Ref<ValidationRule[]>>\n\nexport function useRules (fn?: () => ValidationProps['rules']) {\n  const rules = inject(RulesSymbol, null)\n\n  if (!fn) {\n    if (!rules) {\n      throw new Error('Could not find Vuetify rules injection')\n    }\n    return rules.aliases\n  }\n\n  return rules?.resolve(fn) ?? toRef(fn)\n}\n"],"mappings":"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","ignoreList":[]}