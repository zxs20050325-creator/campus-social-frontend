{"version":3,"file":"hotkey.js","names":["splitKeyCombination","splitKeySequence","onScopeDispose","toValue","watch","IN_BROWSER","useHotkey","keys","callback","options","arguments","length","undefined","event","inputs","preventDefault","sequenceTimeout","isMac","navigator","userAgent","includes","timeout","keyGroups","isSequence","groupIndex","isInputFocused","activeElement","document","tagName","isContentEditable","contentEditable","resetSequence","clearTimeout","handler","e","group","matchesKeyGroup","window","setTimeout","cleanup","removeEventListener","newKeys","groups","toLowerCase","addEventListener","immediate","newEvent","oldEvent","modifiers","actualKey","parseKeyGroup","expectCtrl","ctrl","cmd","meta","expectMeta","ctrlKey","metaKey","shiftKey","shift","altKey","alt","key","MODIFIERS","parts","Object","fromEntries","map","m","part"],"sources":["../../../src/composables/hotkey/hotkey.ts"],"sourcesContent":["// Composables\nimport { splitKeyCombination, splitKeySequence } from '@/composables/hotkey/hotkey-parsing'\n\n// Utilities\nimport { onScopeDispose, toValue, watch } from 'vue'\nimport { IN_BROWSER } from '@/util'\n\n// Types\nimport type { MaybeRef } from '@/util'\n\ninterface HotkeyOptions {\n  event?: MaybeRef<'keydown' | 'keyup'>\n  inputs?: MaybeRef<boolean>\n  preventDefault?: MaybeRef<boolean>\n  sequenceTimeout?: MaybeRef<number>\n}\n\nexport function useHotkey (\n  keys: MaybeRef<string | undefined>,\n  callback: (e: KeyboardEvent) => void,\n  options: HotkeyOptions = {}\n) {\n  if (!IN_BROWSER) return function () {}\n\n  const {\n    event = 'keydown',\n    inputs = false,\n    preventDefault = true,\n    sequenceTimeout = 1000,\n  } = options\n\n  const isMac = navigator?.userAgent?.includes('Macintosh') ?? false\n  let timeout = 0\n  let keyGroups: string[]\n  let isSequence = false\n  let groupIndex = 0\n\n  function isInputFocused () {\n    if (toValue(inputs)) return false\n\n    const activeElement = document.activeElement as HTMLElement\n\n    return activeElement && (\n      activeElement.tagName === 'INPUT' ||\n      activeElement.tagName === 'TEXTAREA' ||\n      activeElement.isContentEditable ||\n      activeElement.contentEditable === 'true'\n    )\n  }\n\n  function resetSequence () {\n    groupIndex = 0\n    clearTimeout(timeout)\n  }\n\n  function handler (e: KeyboardEvent) {\n    const group = keyGroups[groupIndex]\n\n    if (!group || isInputFocused()) return\n\n    if (!matchesKeyGroup(e, group, isMac)) {\n      if (isSequence) resetSequence()\n      return\n    }\n\n    if (toValue(preventDefault)) e.preventDefault()\n\n    if (!isSequence) {\n      callback(e)\n      return\n    }\n\n    clearTimeout(timeout)\n    groupIndex++\n\n    if (groupIndex === keyGroups.length) {\n      callback(e)\n      resetSequence()\n      return\n    }\n\n    timeout = window.setTimeout(resetSequence, toValue(sequenceTimeout))\n  }\n\n  function cleanup () {\n    window.removeEventListener(toValue(event), handler)\n    clearTimeout(timeout)\n  }\n\n  watch(() => toValue(keys), newKeys => {\n    cleanup()\n\n    if (newKeys) {\n      const groups = splitKeySequence(newKeys.toLowerCase())\n      isSequence = groups.length > 1\n      keyGroups = groups\n      resetSequence()\n      window.addEventListener(toValue(event), handler)\n    }\n  }, { immediate: true })\n\n  // Watch for changes in the event type to re-register the listener\n  watch(() => toValue(event), (newEvent, oldEvent) => {\n    if (oldEvent && keyGroups && keyGroups.length > 0) {\n      window.removeEventListener(oldEvent, handler)\n      window.addEventListener(newEvent, handler)\n    }\n  })\n\n  onScopeDispose(cleanup, true)\n\n  return cleanup\n}\n\nfunction matchesKeyGroup (e: KeyboardEvent, group: string, isMac: boolean) {\n  const { modifiers, actualKey } = parseKeyGroup(group)\n\n  const expectCtrl = modifiers.ctrl || (!isMac && (modifiers.cmd || modifiers.meta))\n  const expectMeta = isMac && (modifiers.cmd || modifiers.meta)\n\n  return (\n    e.ctrlKey === expectCtrl &&\n    e.metaKey === expectMeta &&\n    e.shiftKey === modifiers.shift &&\n    e.altKey === modifiers.alt &&\n    e.key.toLowerCase() === actualKey?.toLowerCase()\n  )\n}\n\nfunction parseKeyGroup (group: string) {\n  const MODIFIERS = ['ctrl', 'shift', 'alt', 'meta', 'cmd']\n\n  // Use the shared combination splitting logic\n  const { keys: parts } = splitKeyCombination(group.toLowerCase())\n\n  // If the combination is invalid, return empty result\n  if (parts.length === 0) {\n    return { modifiers: Object.fromEntries(MODIFIERS.map(m => [m, false])), actualKey: undefined }\n  }\n\n  const modifiers = Object.fromEntries(MODIFIERS.map(m => [m, false])) as Record<string, boolean>\n  let actualKey: string | undefined\n\n  for (const part of parts) {\n    if (MODIFIERS.includes(part)) {\n      modifiers[part] = true\n    } else {\n      actualKey = part\n    }\n  }\n\n  return { modifiers, actualKey }\n}\n"],"mappings":"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","ignoreList":[]}