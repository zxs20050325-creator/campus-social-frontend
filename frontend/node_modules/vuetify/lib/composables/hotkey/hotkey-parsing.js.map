{"version":3,"file":"hotkey-parsing.js","names":["normalizeKey","consoleWarn","MODIFIERS","splitKeyCombination","combination","isInternal","arguments","length","undefined","emptyResult","keys","separators","hasInvalidLeadingSeparator","some","v","startsWith","hasInvalidStructure","includes","endsWith","at","buffer","flushBuffer","separator","push","i","char","nextChar","hasInvalidMinus","key","splitKeySequence","str","hasInvalidStart","hasInvalidEnd","result","prevChar","prevPrevChar","precededBySeparator","collapsed","minusCount","part","areAllValid","every","s"],"sources":["../../../src/composables/hotkey/hotkey-parsing.ts"],"sourcesContent":["// Utilities\nimport { normalizeKey } from './key-aliases'\nimport { consoleWarn } from '../../util/console'\n\n// Types\nexport const MODIFIERS = ['ctrl', 'shift', 'alt', 'meta', 'cmd']\n\n/**\n * Splits a single combination string into individual key parts.\n *\n * A combination is a set of keys that must be pressed simultaneously.\n * e.g. `ctrl+k`, `shift--`\n */\nexport function splitKeyCombination (combination: string, isInternal = false): { keys: string[], separators: string[] } {\n  const emptyResult = { keys: [], separators: [] }\n  if (!combination) {\n    if (!isInternal) consoleWarn('Invalid hotkey combination: empty string provided')\n    return emptyResult\n  }\n\n  // --- VALIDATION ---\n\n  const hasInvalidLeadingSeparator = (\n    combination.length > 1 &&\n    // Starts with a single separator followed by a non-separator character (e.g. '+a', '_a')\n    ['+', '/', '_'].some(v => combination.startsWith(v)) &&\n    !['++', '//', '__'].some(v => combination.startsWith(v))\n  )\n\n  const hasInvalidStructure = (\n    hasInvalidLeadingSeparator ||\n    // Disallow literal + or _ keys (they require shift)\n    combination.includes('++') || combination.includes('__') || combination === '+' || combination === '_' ||\n    // Ends with a separator that is not part of a doubled literal\n    (combination.length > 1 && (combination.endsWith('+') || combination.endsWith('_')) && combination.at(-2) !== combination.at(-1)) ||\n    // Stand-alone doubled separators (dangling)\n    combination === '++' || combination === '--' || combination === '__'\n  )\n\n  if (hasInvalidStructure) {\n    if (!isInternal) consoleWarn(`Invalid hotkey combination: \"${combination}\" has invalid structure`)\n    return emptyResult\n  }\n\n  const keys: string[] = []\n  const separators: string[] = []\n  let buffer = ''\n\n  const flushBuffer = (separator?: string) => {\n    if (buffer) {\n      separator && separators.push(separator)\n      keys.push(normalizeKey(buffer))\n      buffer = ''\n    }\n  }\n\n  for (let i = 0; i < combination.length; i++) {\n    const char = combination[i]\n    const nextChar = combination[i + 1]\n\n    if (['+', '/', '_', '-'].includes(char)) {\n      if (char === nextChar) {\n        flushBuffer(char)\n        keys.push(char)\n        i++\n      } else if (['+', '/', '_'].includes(char)) {\n        flushBuffer(char)\n      } else {\n        buffer += char\n      }\n    } else {\n      buffer += char\n    }\n  }\n  flushBuffer()\n\n  // Within a combination, `-` is only valid as a literal key (e.g., `ctrl+-`).\n  // `-` cannot be part of a longer key name within a combination.\n  const hasInvalidMinus = keys.some(key => key.length > 1 && key.includes('-') && key !== '--')\n  if (hasInvalidMinus) {\n    if (!isInternal) consoleWarn(`Invalid hotkey combination: \"${combination}\" has invalid structure`)\n    return emptyResult\n  }\n\n  if (keys.length === 0 && combination) {\n    return { keys: [normalizeKey(combination)], separators }\n  }\n\n  return { keys, separators }\n}\n\n/**\n * Splits a hotkey string into its constituent combination groups.\n *\n * A sequence is a series of combinations that must be pressed in order.\n * e.g. `a-b`, `ctrl+k-p`\n */\nexport function splitKeySequence (str: string): string[] {\n  if (!str) {\n    consoleWarn('Invalid hotkey sequence: empty string provided')\n    return []\n  }\n\n  // A sequence is invalid if it starts or ends with a separator,\n  // unless it is part of a combination (e.g., `shift+-`).\n  const hasInvalidStart = str.startsWith('-') && !['---', '--+'].includes(str)\n  const hasInvalidEnd = str.endsWith('-') && !str.endsWith('+-') && !str.endsWith('_-') && str !== '-' && str !== '---'\n\n  if (hasInvalidStart || hasInvalidEnd) {\n    consoleWarn(`Invalid hotkey sequence: \"${str}\" contains invalid combinations`)\n    return []\n  }\n\n  const result: string[] = []\n  let buffer = ''\n  let i = 0\n\n  while (i < str.length) {\n    const char = str[i]\n\n    if (char === '-') {\n      // Determine if this hyphen is part of the current combination\n      const prevChar = str[i - 1]\n      const prevPrevChar = i > 1 ? str[i - 2] : undefined\n\n      const precededBySeparator = (\n        (['+', '_'].includes(prevChar)) && !['+', '/'].includes(prevPrevChar ?? '')\n      )\n\n      if (precededBySeparator) {\n        // Treat as part of the combination (e.g., 'ctrl+-')\n        buffer += char\n        i++\n      } else {\n        // Treat as sequence separator\n        if (buffer) {\n          result.push(buffer)\n          buffer = ''\n        } else {\n          // Empty buffer means we have a literal '-' key\n          result.push('-')\n        }\n        i++\n      }\n    } else {\n      buffer += char\n      i++\n    }\n  }\n\n  // Add final buffer if it exists\n  if (buffer) {\n    result.push(buffer)\n  }\n\n  // Collapse runs of '-' so that every second '-' is removed\n  const collapsed: string[] = []\n  let minusCount = 0\n  for (const part of result) {\n    if (part === '-') {\n      if (minusCount % 2 === 0) collapsed.push('-')\n      minusCount++\n    } else {\n      minusCount = 0\n      collapsed.push(part)\n    }\n  }\n\n  // Validate that each part of the sequence is a valid combination\n  const areAllValid = collapsed.every(s => splitKeyCombination(s, true).keys.length > 0)\n\n  if (!areAllValid) {\n    consoleWarn(`Invalid hotkey sequence: \"${str}\" contains invalid combinations`)\n    return []\n  }\n\n  return collapsed\n}\n"],"mappings":"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","ignoreList":[]}