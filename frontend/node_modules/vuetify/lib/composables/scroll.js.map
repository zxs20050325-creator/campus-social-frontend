{"version":3,"file":"scroll.js","names":["computed","onBeforeUnmount","onMounted","ref","shallowRef","watch","clamp","consoleWarn","propsFactory","makeScrollProps","scrollTarget","type","String","scrollThreshold","Number","default","useScroll","props","args","arguments","length","undefined","canScroll","layoutSize","previousScroll","previousScrollHeight","target","currentScroll","savedScroll","currentThreshold","isScrollActive","isScrollingUp","isAtBottom","reachedBottomWhileScrollingDown","hasEnoughScrollableSpace","scrollRatio","value","getScrollMetrics","targetEl","clientHeight","window","innerHeight","scrollHeight","document","documentElement","checkScrollableSpace","maxScrollableDistance","elementHeight","minRequiredDistance","onResize","onScroll","pageYOffset","scrollTop","currentScrollHeight","Window","Math","abs","atBottom","scrollJumped","atTop","scrolledUpSignificantly","newTarget","querySelector","removeEventListener","addEventListener","passive","Promise","resolve","then","immediate"],"sources":["../../src/composables/scroll.ts"],"sourcesContent":["// Utilities\nimport {\n  computed,\n  onBeforeUnmount,\n  onMounted,\n  ref,\n  shallowRef,\n  watch,\n} from 'vue'\nimport { clamp, consoleWarn, propsFactory } from '@/util'\n\n// Types\nimport type { Ref } from 'vue'\n\nexport interface ScrollProps {\n  scrollTarget?: string\n  scrollThreshold?: string | number\n}\n\nexport interface ThresholdMetCallbackData {\n  isScrollingUp: boolean\n  currentThreshold: number\n  savedScroll: Ref<number>\n}\n\n// Composables\nexport const makeScrollProps = propsFactory({\n  scrollTarget: {\n    type: String,\n  },\n  scrollThreshold: {\n    type: [String, Number],\n    default: 300,\n  },\n}, 'scroll')\n\nexport interface ScrollArguments {\n  canScroll?: Readonly<Ref<boolean>>\n  layoutSize?: Readonly<Ref<number>>\n}\n\nexport function useScroll (\n  props: ScrollProps,\n  args: ScrollArguments = {},\n) {\n  const { canScroll, layoutSize } = args\n  let previousScroll = 0\n  let previousScrollHeight = 0\n  const target = ref<Element | Window | null>(null)\n  const currentScroll = shallowRef(0)\n  const savedScroll = shallowRef(0)\n  const currentThreshold = shallowRef(0)\n  const isScrollActive = shallowRef(false)\n  const isScrollingUp = shallowRef(false)\n  const isAtBottom = shallowRef(false)\n  const reachedBottomWhileScrollingDown = shallowRef(false)\n  const hasEnoughScrollableSpace = shallowRef(true)\n\n  const scrollThreshold = computed(() => {\n    return Number(props.scrollThreshold)\n  })\n\n  /**\n   * 1: at top\n   * 0: at threshold\n   */\n  const scrollRatio = computed(() => {\n    return clamp(((scrollThreshold.value - currentScroll.value) / scrollThreshold.value) || 0)\n  })\n\n  function getScrollMetrics (targetEl: Element | Window) {\n    const clientHeight = ('window' in targetEl) ? window.innerHeight : targetEl.clientHeight\n    const scrollHeight = ('window' in targetEl) ? document.documentElement.scrollHeight : targetEl.scrollHeight\n    return { clientHeight, scrollHeight }\n  }\n\n  function checkScrollableSpace () {\n    const targetEl = target.value\n    if (!targetEl) return\n\n    const { clientHeight, scrollHeight } = getScrollMetrics(targetEl)\n    const maxScrollableDistance = scrollHeight - clientHeight\n\n    // When the scroll-hide element (like AppBar) hides, it causes the page to grow\n    // We need extra scrollable space beyond the threshold to prevent bouncing\n    // Add the element's height to the required minimum distance\n    const elementHeight = layoutSize?.value || 0\n    const minRequiredDistance = scrollThreshold.value + elementHeight\n\n    // Only enable scroll-hide if there's enough scrollable space\n    hasEnoughScrollableSpace.value = maxScrollableDistance > minRequiredDistance\n  }\n\n  function onResize () {\n    checkScrollableSpace()\n  }\n\n  function onScroll () {\n    const targetEl = target.value\n\n    if (!targetEl || (canScroll && !canScroll.value)) return\n\n    previousScroll = currentScroll.value\n    currentScroll.value = ('window' in targetEl) ? targetEl.pageYOffset : targetEl.scrollTop\n\n    const currentScrollHeight = targetEl instanceof Window ? document.documentElement.scrollHeight : targetEl.scrollHeight\n    if (previousScrollHeight !== currentScrollHeight) {\n      // If page is growing (content loading), recalculate scrollable space\n      // If page is shrinking (likely due to navbar animation), don't recalculate\n      if (currentScrollHeight > previousScrollHeight) {\n        checkScrollableSpace()\n      }\n      previousScrollHeight = currentScrollHeight\n    }\n\n    isScrollingUp.value = currentScroll.value < previousScroll\n    currentThreshold.value = Math.abs(currentScroll.value - scrollThreshold.value)\n\n    // Detect if at bottom of page\n    const { clientHeight, scrollHeight } = getScrollMetrics(targetEl)\n    const atBottom = currentScroll.value + clientHeight >= scrollHeight - 5\n\n    // Track when bottom is reached during downward scroll\n    // Only set flag if ALL conditions are met:\n    // 1. Scrolled past threshold (navbar is hiding)\n    // 2. Page has enough scrollable space for scroll-hide\n    // This prevents activation on short pages or edge cases\n    if (!isScrollingUp.value && atBottom &&\n        currentScroll.value >= scrollThreshold.value &&\n        hasEnoughScrollableSpace.value) {\n      reachedBottomWhileScrollingDown.value = true\n    }\n\n    // Reset the flag when:\n    // 1. Scrolling up away from bottom (with small tolerance for touchpad/momentum scrolling)\n    // 2. Scroll position jumped significantly (e.g., navigation, scroll restoration)\n    // 3. Scroll is at the very top (page navigation resets to top)\n    const scrollJumped = Math.abs(currentScroll.value - previousScroll) > 100\n    const atTop = currentScroll.value <= 5\n    const scrolledUpSignificantly = isScrollingUp.value && (previousScroll - currentScroll.value) > 1\n    if ((scrolledUpSignificantly && !atBottom) || (scrollJumped && currentScroll.value < scrollThreshold.value) || atTop) {\n      reachedBottomWhileScrollingDown.value = false\n    }\n\n    // Update state\n    isAtBottom.value = atBottom\n  }\n\n  watch(isScrollingUp, () => {\n    savedScroll.value = savedScroll.value || currentScroll.value\n  })\n\n  watch(isScrollActive, () => {\n    savedScroll.value = 0\n  })\n\n  onMounted(() => {\n    watch(() => props.scrollTarget, scrollTarget => {\n      const newTarget = scrollTarget ? document.querySelector(scrollTarget) : window\n\n      if (!newTarget) {\n        consoleWarn(`Unable to locate element with identifier ${scrollTarget}`)\n        return\n      }\n\n      if (newTarget === target.value) return\n\n      target.value?.removeEventListener('scroll', onScroll)\n      target.value = newTarget\n      target.value.addEventListener('scroll', onScroll, { passive: true })\n\n      // Check scrollable space when target is set\n      Promise.resolve().then(() => {\n        checkScrollableSpace()\n      })\n    }, { immediate: true })\n\n    // Listen to window resize to recalculate scrollable space\n    window.addEventListener('resize', onResize, { passive: true })\n  })\n\n  onBeforeUnmount(() => {\n    target.value?.removeEventListener('scroll', onScroll)\n    window.removeEventListener('resize', onResize)\n  })\n\n  // Do we need this? If yes - seems that\n  // there's no need to expose onScroll\n  canScroll && watch(canScroll, onScroll, { immediate: true })\n\n  return {\n    scrollThreshold,\n    currentScroll,\n    currentThreshold,\n    isScrollActive,\n    scrollRatio,\n\n    // required only for testing\n    // probably can be removed\n    // later (2 chars chlng)\n    isScrollingUp,\n    savedScroll,\n    isAtBottom,\n    reachedBottomWhileScrollingDown,\n    hasEnoughScrollableSpace,\n  }\n}\n"],"mappings":"AAAA;AACA,SACEA,QAAQ,EACRC,eAAe,EACfC,SAAS,EACTC,GAAG,EACHC,UAAU,EACVC,KAAK,QACA,KAAK;AAAA,SACHC,KAAK,EAAEC,WAAW,EAAEC,YAAY,4BAEzC;AAcA;AACA,OAAO,MAAMC,eAAe,GAAGD,YAAY,CAAC;EAC1CE,YAAY,EAAE;IACZC,IAAI,EAAEC;EACR,CAAC;EACDC,eAAe,EAAE;IACfF,IAAI,EAAE,CAACC,MAAM,EAAEE,MAAM,CAAC;IACtBC,OAAO,EAAE;EACX;AACF,CAAC,EAAE,QAAQ,CAAC;AAOZ,OAAO,SAASC,SAASA,CACvBC,KAAkB,EAElB;EAAA,IADAC,IAAqB,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,CAAC,CAAC;EAE1B,MAAM;IAAEG,SAAS;IAAEC;EAAW,CAAC,GAAGL,IAAI;EACtC,IAAIM,cAAc,GAAG,CAAC;EACtB,IAAIC,oBAAoB,GAAG,CAAC;EAC5B,MAAMC,MAAM,GAAGvB,GAAG,CAA0B,IAAI,CAAC;EACjD,MAAMwB,aAAa,GAAGvB,UAAU,CAAC,CAAC,CAAC;EACnC,MAAMwB,WAAW,GAAGxB,UAAU,CAAC,CAAC,CAAC;EACjC,MAAMyB,gBAAgB,GAAGzB,UAAU,CAAC,CAAC,CAAC;EACtC,MAAM0B,cAAc,GAAG1B,UAAU,CAAC,KAAK,CAAC;EACxC,MAAM2B,aAAa,GAAG3B,UAAU,CAAC,KAAK,CAAC;EACvC,MAAM4B,UAAU,GAAG5B,UAAU,CAAC,KAAK,CAAC;EACpC,MAAM6B,+BAA+B,GAAG7B,UAAU,CAAC,KAAK,CAAC;EACzD,MAAM8B,wBAAwB,GAAG9B,UAAU,CAAC,IAAI,CAAC;EAEjD,MAAMS,eAAe,GAAGb,QAAQ,CAAC,MAAM;IACrC,OAAOc,MAAM,CAACG,KAAK,CAACJ,eAAe,CAAC;EACtC,CAAC,CAAC;;EAEF;AACF;AACA;AACA;EACE,MAAMsB,WAAW,GAAGnC,QAAQ,CAAC,MAAM;IACjC,OAAOM,KAAK,CAAE,CAACO,eAAe,CAACuB,KAAK,GAAGT,aAAa,CAACS,KAAK,IAAIvB,eAAe,CAACuB,KAAK,IAAK,CAAC,CAAC;EAC5F,CAAC,CAAC;EAEF,SAASC,gBAAgBA,CAAEC,QAA0B,EAAE;IACrD,MAAMC,YAAY,GAAI,QAAQ,IAAID,QAAQ,GAAIE,MAAM,CAACC,WAAW,GAAGH,QAAQ,CAACC,YAAY;IACxF,MAAMG,YAAY,GAAI,QAAQ,IAAIJ,QAAQ,GAAIK,QAAQ,CAACC,eAAe,CAACF,YAAY,GAAGJ,QAAQ,CAACI,YAAY;IAC3G,OAAO;MAAEH,YAAY;MAAEG;IAAa,CAAC;EACvC;EAEA,SAASG,oBAAoBA,CAAA,EAAI;IAC/B,MAAMP,QAAQ,GAAGZ,MAAM,CAACU,KAAK;IAC7B,IAAI,CAACE,QAAQ,EAAE;IAEf,MAAM;MAAEC,YAAY;MAAEG;IAAa,CAAC,GAAGL,gBAAgB,CAACC,QAAQ,CAAC;IACjE,MAAMQ,qBAAqB,GAAGJ,YAAY,GAAGH,YAAY;;IAEzD;IACA;IACA;IACA,MAAMQ,aAAa,GAAGxB,UAAU,EAAEa,KAAK,IAAI,CAAC;IAC5C,MAAMY,mBAAmB,GAAGnC,eAAe,CAACuB,KAAK,GAAGW,aAAa;;IAEjE;IACAb,wBAAwB,CAACE,KAAK,GAAGU,qBAAqB,GAAGE,mBAAmB;EAC9E;EAEA,SAASC,QAAQA,CAAA,EAAI;IACnBJ,oBAAoB,CAAC,CAAC;EACxB;EAEA,SAASK,QAAQA,CAAA,EAAI;IACnB,MAAMZ,QAAQ,GAAGZ,MAAM,CAACU,KAAK;IAE7B,IAAI,CAACE,QAAQ,IAAKhB,SAAS,IAAI,CAACA,SAAS,CAACc,KAAM,EAAE;IAElDZ,cAAc,GAAGG,aAAa,CAACS,KAAK;IACpCT,aAAa,CAACS,KAAK,GAAI,QAAQ,IAAIE,QAAQ,GAAIA,QAAQ,CAACa,WAAW,GAAGb,QAAQ,CAACc,SAAS;IAExF,MAAMC,mBAAmB,GAAGf,QAAQ,YAAYgB,MAAM,GAAGX,QAAQ,CAACC,eAAe,CAACF,YAAY,GAAGJ,QAAQ,CAACI,YAAY;IACtH,IAAIjB,oBAAoB,KAAK4B,mBAAmB,EAAE;MAChD;MACA;MACA,IAAIA,mBAAmB,GAAG5B,oBAAoB,EAAE;QAC9CoB,oBAAoB,CAAC,CAAC;MACxB;MACApB,oBAAoB,GAAG4B,mBAAmB;IAC5C;IAEAtB,aAAa,CAACK,KAAK,GAAGT,aAAa,CAACS,KAAK,GAAGZ,cAAc;IAC1DK,gBAAgB,CAACO,KAAK,GAAGmB,IAAI,CAACC,GAAG,CAAC7B,aAAa,CAACS,KAAK,GAAGvB,eAAe,CAACuB,KAAK,CAAC;;IAE9E;IACA,MAAM;MAAEG,YAAY;MAAEG;IAAa,CAAC,GAAGL,gBAAgB,CAACC,QAAQ,CAAC;IACjE,MAAMmB,QAAQ,GAAG9B,aAAa,CAACS,KAAK,GAAGG,YAAY,IAAIG,YAAY,GAAG,CAAC;;IAEvE;IACA;IACA;IACA;IACA;IACA,IAAI,CAACX,aAAa,CAACK,KAAK,IAAIqB,QAAQ,IAChC9B,aAAa,CAACS,KAAK,IAAIvB,eAAe,CAACuB,KAAK,IAC5CF,wBAAwB,CAACE,KAAK,EAAE;MAClCH,+BAA+B,CAACG,KAAK,GAAG,IAAI;IAC9C;;IAEA;IACA;IACA;IACA;IACA,MAAMsB,YAAY,GAAGH,IAAI,CAACC,GAAG,CAAC7B,aAAa,CAACS,KAAK,GAAGZ,cAAc,CAAC,GAAG,GAAG;IACzE,MAAMmC,KAAK,GAAGhC,aAAa,CAACS,KAAK,IAAI,CAAC;IACtC,MAAMwB,uBAAuB,GAAG7B,aAAa,CAACK,KAAK,IAAKZ,cAAc,GAAGG,aAAa,CAACS,KAAK,GAAI,CAAC;IACjG,IAAKwB,uBAAuB,IAAI,CAACH,QAAQ,IAAMC,YAAY,IAAI/B,aAAa,CAACS,KAAK,GAAGvB,eAAe,CAACuB,KAAM,IAAIuB,KAAK,EAAE;MACpH1B,+BAA+B,CAACG,KAAK,GAAG,KAAK;IAC/C;;IAEA;IACAJ,UAAU,CAACI,KAAK,GAAGqB,QAAQ;EAC7B;EAEApD,KAAK,CAAC0B,aAAa,EAAE,MAAM;IACzBH,WAAW,CAACQ,KAAK,GAAGR,WAAW,CAACQ,KAAK,IAAIT,aAAa,CAACS,KAAK;EAC9D,CAAC,CAAC;EAEF/B,KAAK,CAACyB,cAAc,EAAE,MAAM;IAC1BF,WAAW,CAACQ,KAAK,GAAG,CAAC;EACvB,CAAC,CAAC;EAEFlC,SAAS,CAAC,MAAM;IACdG,KAAK,CAAC,MAAMY,KAAK,CAACP,YAAY,EAAEA,YAAY,IAAI;MAC9C,MAAMmD,SAAS,GAAGnD,YAAY,GAAGiC,QAAQ,CAACmB,aAAa,CAACpD,YAAY,CAAC,GAAG8B,MAAM;MAE9E,IAAI,CAACqB,SAAS,EAAE;QACdtD,WAAW,CAAC,4CAA4CG,YAAY,EAAE,CAAC;QACvE;MACF;MAEA,IAAImD,SAAS,KAAKnC,MAAM,CAACU,KAAK,EAAE;MAEhCV,MAAM,CAACU,KAAK,EAAE2B,mBAAmB,CAAC,QAAQ,EAAEb,QAAQ,CAAC;MACrDxB,MAAM,CAACU,KAAK,GAAGyB,SAAS;MACxBnC,MAAM,CAACU,KAAK,CAAC4B,gBAAgB,CAAC,QAAQ,EAAEd,QAAQ,EAAE;QAAEe,OAAO,EAAE;MAAK,CAAC,CAAC;;MAEpE;MACAC,OAAO,CAACC,OAAO,CAAC,CAAC,CAACC,IAAI,CAAC,MAAM;QAC3BvB,oBAAoB,CAAC,CAAC;MACxB,CAAC,CAAC;IACJ,CAAC,EAAE;MAAEwB,SAAS,EAAE;IAAK,CAAC,CAAC;;IAEvB;IACA7B,MAAM,CAACwB,gBAAgB,CAAC,QAAQ,EAAEf,QAAQ,EAAE;MAAEgB,OAAO,EAAE;IAAK,CAAC,CAAC;EAChE,CAAC,CAAC;EAEFhE,eAAe,CAAC,MAAM;IACpByB,MAAM,CAACU,KAAK,EAAE2B,mBAAmB,CAAC,QAAQ,EAAEb,QAAQ,CAAC;IACrDV,MAAM,CAACuB,mBAAmB,CAAC,QAAQ,EAAEd,QAAQ,CAAC;EAChD,CAAC,CAAC;;EAEF;EACA;EACA3B,SAAS,IAAIjB,KAAK,CAACiB,SAAS,EAAE4B,QAAQ,EAAE;IAAEmB,SAAS,EAAE;EAAK,CAAC,CAAC;EAE5D,OAAO;IACLxD,eAAe;IACfc,aAAa;IACbE,gBAAgB;IAChBC,cAAc;IACdK,WAAW;IAEX;IACA;IACA;IACAJ,aAAa;IACbH,WAAW;IACXI,UAAU;IACVC,+BAA+B;IAC/BC;EACF,CAAC;AACH","ignoreList":[]}