{"version":3,"file":"list-items.js","names":["computed","shallowRef","watchEffect","deepEqual","getPropertyFromItem","isPrimitive","omit","pick","propsFactory","makeItemsProps","items","type","Array","default","itemTitle","String","Function","itemValue","itemChildren","Boolean","itemProps","itemType","returnObject","valueComparator","itemTypes","Set","transformItem","props","item","title","value","children","isArray","undefined","has","_props","transformItems","raw","neededProps","array","push","useItems","hasNullItem","some","itemsMap","Map","keylessItems","_items","map","keyless","i","length","values","get","set","transformIn","_allItems","_keylessItems","_hasNullItem","_returnObject","hasValueComparator","returnValue","main","v","fastItems","transformOut","_ref","_ref2"],"sources":["../../src/composables/list-items.ts"],"sourcesContent":["// Utilities\nimport { computed, shallowRef, watchEffect } from 'vue'\nimport { deepEqual, getPropertyFromItem, isPrimitive, omit, pick, propsFactory } from '@/util'\n\n// Types\nimport type { PropType } from 'vue'\nimport type { InternalItem } from '@/composables/filter'\nimport type { Primitive, SelectItemKey, ValueComparator } from '@/util'\n\nexport interface ListItem<T = any> extends InternalItem<T> {\n  title: string\n  props: {\n    [key: string]: any\n    title: string\n    value: any\n  }\n  children: ListItem<T>[] | undefined\n  type: string\n}\n\nexport interface ItemProps {\n  items: any[]\n  itemTitle: SelectItemKey\n  itemValue: SelectItemKey\n  itemChildren: SelectItemKey\n  itemProps: SelectItemKey\n  itemType: SelectItemKey\n  returnObject: boolean\n  valueComparator: ValueComparator | undefined\n}\n\n// Composables\nexport const makeItemsProps = propsFactory({\n  items: {\n    type: Array as PropType<ItemProps['items']>,\n    default: () => ([]),\n  },\n  itemTitle: {\n    type: [String, Array, Function] as PropType<SelectItemKey>,\n    default: 'title',\n  },\n  itemValue: {\n    type: [String, Array, Function] as PropType<SelectItemKey>,\n    default: 'value',\n  },\n  itemChildren: {\n    type: [Boolean, String, Array, Function] as PropType<SelectItemKey>,\n    default: 'children',\n  },\n  itemProps: {\n    type: [Boolean, String, Array, Function] as PropType<SelectItemKey>,\n    default: 'props',\n  },\n  itemType: {\n    type: [Boolean, String, Array, Function] as PropType<SelectItemKey>,\n    default: 'type',\n  },\n  returnObject: Boolean,\n  valueComparator: Function as PropType<ValueComparator>,\n}, 'list-items')\n\nconst itemTypes = new Set(['item', 'divider', 'subheader'])\n\nexport function transformItem (\n  props: Pick<ItemProps, typeof transformItem.neededProps[number]>,\n  item: any\n): ListItem {\n  const title = getPropertyFromItem(item, props.itemTitle, item)\n  const value = getPropertyFromItem(item, props.itemValue, title)\n  const children = getPropertyFromItem(item, props.itemChildren)\n  const itemProps = props.itemProps === true\n    ? typeof item === 'object' && item != null && !Array.isArray(item)\n      ? 'children' in item\n        ? omit(item, ['children'])\n        : item\n      : undefined\n    : getPropertyFromItem(item, props.itemProps)\n\n  let type = getPropertyFromItem(item, props.itemType, 'item')\n  if (!itemTypes.has(type)) {\n    type = 'item'\n  }\n\n  const _props = {\n    title,\n    value,\n    ...itemProps,\n  }\n\n  return {\n    type,\n    title: String(_props.title ?? ''),\n    value: _props.value,\n    props: _props,\n    children: type === 'item' && Array.isArray(children) ? transformItems(props, children) : undefined,\n    raw: item,\n  }\n}\n\ntransformItem.neededProps = [\n  'itemTitle',\n  'itemValue',\n  'itemChildren',\n  'itemProps',\n  'itemType',\n] as const\n\nexport function transformItems (\n  props: Pick<ItemProps, typeof transformItem.neededProps[number]>,\n  items: ItemProps['items']\n) {\n  // avoid reactive access in the loop\n  const _props = pick(props, transformItem.neededProps)\n\n  const array: ListItem[] = []\n  for (const item of items) {\n    array.push(transformItem(_props, item))\n  }\n\n  return array\n}\n\nexport function useItems (props: ItemProps) {\n  const items = computed(() => transformItems(props, props.items))\n  const hasNullItem = computed(() => items.value.some(item => item.value === null))\n\n  const itemsMap = shallowRef<Map<Primitive, ListItem[]>>(new Map())\n  const keylessItems = shallowRef<ListItem[]>([])\n  watchEffect(() => {\n    const _items = items.value\n    const map = new Map()\n    const keyless = []\n    for (let i = 0; i < _items.length; i++) {\n      const item = _items[i]\n      if (isPrimitive(item.value) || item.value === null) {\n        let values = map.get(item.value)\n        if (!values) {\n          values = []\n          map.set(item.value, values)\n        }\n        values.push(item)\n      } else {\n        keyless.push(item)\n      }\n    }\n    itemsMap.value = map\n    keylessItems.value = keyless\n  })\n\n  function transformIn (value: any[]): ListItem[] {\n    // Cache unrefed values outside the loop,\n    // proxy getters can be slow when you call them a billion times\n    const _items = itemsMap.value\n    const _allItems = items.value\n    const _keylessItems = keylessItems.value\n    const _hasNullItem = hasNullItem.value\n    const _returnObject = props.returnObject\n    const hasValueComparator = !!props.valueComparator\n    const valueComparator = props.valueComparator || deepEqual\n    const _props = pick(props, transformItem.neededProps)\n\n    const returnValue: ListItem[] = []\n    main: for (const v of value) {\n      // When the model value is null, return an InternalItem\n      // based on null only if null is one of the items\n      if (!_hasNullItem && v === null) continue\n\n      // String model value means value is a custom input value from combobox\n      // Don't look up existing items if the model value is a string\n      if (_returnObject && typeof v === 'string') {\n        returnValue.push(transformItem(_props, v))\n        continue\n      }\n\n      // Fast path, items with primitive values and no\n      // custom valueComparator can use a constant-time\n      // map lookup instead of searching the items array\n      const fastItems = _items.get(v)\n\n      // Slow path, always use valueComparator.\n      // This is O(n^2) so we really don't want to\n      // do it for more than a couple hundred items.\n      if (hasValueComparator || !fastItems) {\n        for (const item of (hasValueComparator ? _allItems : _keylessItems)) {\n          if (valueComparator(v, item.value)) {\n            returnValue.push(item)\n            continue main\n          }\n        }\n        // Not an existing item, construct it from the model (#4000)\n        returnValue.push(transformItem(_props, v))\n        continue\n      }\n\n      returnValue.push(...fastItems)\n    }\n\n    return returnValue\n  }\n\n  function transformOut (value: ListItem[]): any[] {\n    return props.returnObject\n      ? value.map(({ raw }) => raw)\n      : value.map(({ value }) => value)\n  }\n\n  return { items, transformIn, transformOut }\n}\n"],"mappings":"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","ignoreList":[]}